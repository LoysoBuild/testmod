package com.test_project.combat;

import com.test_project.combat.stance.StanceType;
import net.minecraft.nbt.CompoundTag;

public class PlayerCombatSettings {
    private StanceType currentStance = StanceType.ATTACK;
    private int stanceCooldownTicks = 0;
    private boolean isInCombat = false;
    private int combatTimer = 0;

    public void setCurrentStance(StanceType stance) {
        this.currentStance = stance;
    }

    public StanceType getCurrentStance() {
        return currentStance;
    }

    public void setStanceCooldown(int ticks) {
        this.stanceCooldownTicks = ticks;
    }

    public void tickCooldown() {
        if (stanceCooldownTicks > 0) stanceCooldownTicks--;
        if (combatTimer > 0) combatTimer--;
        if (combatTimer <= 0) isInCombat = false;
    }

    public boolean isStanceCooldown() {
        return stanceCooldownTicks > 0;
    }

    public void enterCombat() {
        this.isInCombat = true;
        this.combatTimer = 100;
    }

    public boolean isInCombat() {
        return isInCombat;
    }

    public CompoundTag saveToNBT() {
        CompoundTag tag = new CompoundTag();
        tag.putString("currentStance", currentStance.name());
        tag.putInt("stanceCooldownTicks", stanceCooldownTicks);
        tag.putBoolean("isInCombat", isInCombat);
        tag.putInt("combatTimer", combatTimer);
        return tag;
    }

    public void loadFromNBT(CompoundTag tag) {
        if (tag.contains("currentStance")) {
            try {
                this.currentStance = StanceType.valueOf(tag.getString("currentStance"));
            } catch (IllegalArgumentException e) {
                this.currentStance = StanceType.ATTACK;
            }
        }
        this.stanceCooldownTicks = tag.getInt("stanceCooldownTicks");
        this.isInCombat = tag.getBoolean("isInCombat");
        this.combatTimer = tag.getInt("combatTimer");
    }
}
